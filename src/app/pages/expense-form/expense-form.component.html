<div class="max-w-4xl mx-auto p-4 sm:p-6 pb-0 sm:pb-0 flex flex-col min-h-dvh">
  <div class="flex items-center gap-3 mb-4 text-primary">
    <button
      mat-button
      (click)="onCancel()"
      class="min-w-[unset]! w-auto! shrink-0"
      aria-label="Go back"
    >
      <mat-icon class="mr-0! text-2xl! w-6! h-6! text-primary!">arrow_back</mat-icon>
    </button>
    <h2 class="text-lg! sm:text-xl! md:text-2xl! text-primary flex items-center gap-3 flex-1">
      {{ isEditMode ? 'Edit Expense' : 'New Expense' }}
    </h2>
  </div>

  <div class="flex-1 overflow-y-auto px-4">
    <form [formGroup]="form" class="flex flex-col w-full">
      <!-- Title Field -->
      <div class="space-y-2">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <mat-icon class="text-base! text-primary-600">title</mat-icon>
          Expense Title
        </label>
        <mat-form-field appearance="outline" class="w-full">
          <input
            matInput
            formControlName="title"
            placeholder="Enter a descriptive title for your expense"
            class="text-base"
          />
          @if (form.get('title')?.hasError('required') && form.get('title')?.touched) {
          <mat-error>Title is required</mat-error>
          }
        </mat-form-field>
      </div>

      <!-- Description Field -->
      <div class="space-y-2">
        <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
          <mat-icon class="text-base! text-primary-600">description</mat-icon>
          Description
        </label>
        <mat-form-field appearance="outline" class="w-full">
          <textarea
            matInput
            formControlName="description"
            placeholder="Enter an optional description for your expense"
            class="text-base"
            rows="3"
          ></textarea>
        </mat-form-field>
      </div>

      <!-- Icon and Color Selection in Grid -->
      <div class="grid grid-cols-1 md:grid-cols-2">
        <!-- Icon Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
            <mat-icon class="text-base! text-primary-600">palette</mat-icon>
            Icon
          </label>
          <mat-form-field appearance="outline" class="w-full">
            <mat-select formControlName="icon">
              <mat-select-trigger>
                @if (getSelectedIcon(); as selectedIcon) {
                <div class="flex items-center gap-3 py-1">
                  <mat-icon class="text-primary-600">{{ selectedIcon.value }}</mat-icon>
                  <span class="font-medium">{{ selectedIcon.label }}</span>
                </div>
                }
              </mat-select-trigger>
              @for (icon of icons; track icon.value) {
              <mat-option [value]="icon.value">
                <div class="flex items-center gap-3 py-1">
                  <mat-icon class="text-gray-600">{{ icon.value }}</mat-icon>
                  <span>{{ icon.label }}</span>
                </div>
              </mat-option>
              }
            </mat-select>
            @if (form.get('icon')?.hasError('required') && form.get('icon')?.touched) {
            <mat-error>Icon is required</mat-error>
            }
          </mat-form-field>
        </div>

        <!-- Color Field -->
        <div class="space-y-2">
          <label class="text-sm font-semibold text-gray-700 flex items-center gap-2">
            <mat-icon class="text-base! text-primary-600">color_lens</mat-icon>
            Color Theme
          </label>
          <div class="w-full">
            <app-color-picker [colors]="colorOptions" formControlName="color"></app-color-picker>
            @if (form.get('color')?.hasError('required') && form.get('color')?.touched) {
            <div class="text-xs text-red-600 mt-1 ml-1">Color is required</div>
            }
          </div>
        </div>
      </div>

      <!-- Preview Section -->
      @if (form.get('title')?.value || form.get('icon')?.value || form.get('color')?.value) {
      <div class="p-4 rounded-xl border-2 border-dashed border-gray-200 bg-gray-50">
        <p class="text-xs font-semibold text-gray-500 uppercase mb-4">Preview</p>

        <app-expense-card [expense]="form.value" />
      </div>
      }
    </form>
  </div>

  <div class="-ml-6 -mr-6 mt-6 px-10 pt-4 pb-6 bg-gray-50 border-t border-gray-200 rounded-b-lg">
    <div class="flex items-center gap-3 w-full justify-end">
      <button
        mat-button
        (click)="onCancel()"
        class="px-6 py-2 font-medium text-gray-600 hover:bg-gray-100"
      >
        <mat-icon class="text-lg">close</mat-icon>
        <span>Cancel</span>
      </button>
      <button
        mat-raised-button
        color="primary"
        (click)="onSubmit()"
        [disabled]="!form.valid"
        class="px-6 py-2 font-semibold shadow-md hover:shadow-lg transition-shadow"
      >
        <mat-icon class="text-lg">{{ isEditMode ? 'save' : 'add_circle' }}</mat-icon>
        <span>{{ isEditMode ? 'Save Changes' : 'Create Expense' }}</span>
      </button>
    </div>
  </div>
</div>

